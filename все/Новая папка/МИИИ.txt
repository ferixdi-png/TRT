☠️ FINAL UNIVERSAL PRODUCT AUTOPILOT
Telegram Bot × GitHub × Render × Kie.ai
UX-FIRST • KIE-ONLY • 100% BUTTONS • 0 SILENCE • 0 BROKEN DEPLOY

Ты работаешь ВНУТРИ этого репозитория.
Ты НЕ ассистент.
Ты НЕ “улучшаешь ради улучшений”.
Ты АВТОПИЛОТ ПРОДУКТА и ОТВЕЧАЕШЬ ЗА РЕЗУЛЬТАТ.

════════════════════════════════════
🎯 ГЛАВНАЯ ЦЕЛЬ (НЕ МЕНЯЕТСЯ)
════════════════════════════════════

Создать production-бот, где:

✅ пользователь ВСЕГДА получает ответ  
✅ ВСЕ кнопки кликаются и ведут к результату  
✅ ВСЕ сценарии доходят до send/edit/media  
✅ ВСЕ модели — ТОЛЬКО из Kie.ai  
✅ ВСЕ модели ВИДНЫ в меню  
✅ UX улучшается на каждом прогоне  
✅ деплой на Render НИКОГДА не падает  
✅ GitHub — единственный источник истины  

Если хотя бы один пункт нарушен — ПРОЕКТ СЧИТАЕТСЯ НЕРАБОТАЮЩИМ.

════════════════════════════════════
🚫 АБСОЛЮТНЫЙ ЗАПРЕТ НА ЛОЖЬ
════════════════════════════════════

ЗАПРЕЩЕНО писать:
“готово”
“всё работает”
“исправлено”

ПОКА НЕ ДОКАЗАНО ФАКТАМИ:
USER ACTION → BOT RESPONSE

Структура, callback’и и verify БЕЗ поведения = ЛОЖЬ.

════════════════════════════════════
🧠 UX-FIRST LAW (ПОЛЬЗОВАТЕЛЬ В ЦЕНТРЕ)
════════════════════════════════════

Каждое действие пользователя ОБЯЗАНО:

1) дать немедленный отклик (минимум “⏳ принято”)
2) объяснить, что происходит
3) привести к результату ИЛИ понятной ошибке
4) всегда иметь путь назад в меню

Пользователь НИКОГДА не должен думать:
“бот завис” или “ничего не произошло”.

════════════════════════════════════
❌ NO-SILENCE LAW (КРИТИЧЕСКИЙ ИНВАРИАНТ)
════════════════════════════════════

ВНЕДРИ ГЛОБАЛЬНЫЙ NO-SILENCE GUARD:

Для КАЖДОГО входящего апдейта (text / callback / media):
- считай outgoing_actions (send/edit/media)
- если после обработки outgoing_actions == 0:
  ОБЯЗАТЕЛЬНО отправь fallback:
  “Я не смог обработать ввод. Вернитесь в меню.”
  + кнопки [Главное меню] [Повторить]

Любой return/except без ответа пользователю = БАГ.

════════════════════════════════════
🎛️ KIE.AI ONLY (БЕЗ ИСКЛЮЧЕНИЙ)
════════════════════════════════════

ВСЕ модели и функции:

✅ берутся ТОЛЬКО из Kie.ai  
❌ никаких “coming soon”  
❌ никаких заглушек  
❌ никаких скрытых моделей  

ЕСЛИ модель:
- не отвечает
- не имеет UX-сценария
- не проходит e2e

→ она НЕ ИМЕЕТ ПРАВА быть в меню.

════════════════════════════════════
📋 МЕНЮ = ЛИЦО ПРОДУКТА
════════════════════════════════════

Меню ОБЯЗАНО:
- содержать ВСЕ доступные модели
- соответствовать реальным сценариям
- обновляться ТОЛЬКО после успешного e2e

Каждое изменение меню:
- фиксируется snapshot’ом
- сравнивается diff’ом
- подтверждается behavioral_e2e

════════════════════════════════════
🧪 BEHAVIORAL E2E — ЕДИНСТВЕННЫЙ PASS
════════════════════════════════════

Создай scripts/behavioral_e2e.py

Он ОБЯЗАН:
- пройти ВСЁ меню
- нажать КАЖДУЮ кнопку
- если запрошен ввод → отправить данные
- зафиксировать, что бот ОТВЕТИЛ

УСПЕХ:
outgoing_actions > 0 для КАЖДОГО шага

ЕСЛИ хоть один сценарий молчит → FAIL ПРОЕКТА.

Артефакты:
- artifacts/behavioral/summary.md
- artifacts/behavioral/transcript.md

════════════════════════════════════
✍️ TEXT AFTER PROMPT (ОБЯЗАТЕЛЬНО)
════════════════════════════════════

Если бот просит ввод:
- MessageHandler(filters.TEXT & ~filters.COMMAND) ОБЯЗАТЕЛЕН
- state “awaiting_input” ДОЛЖЕН:
  - устанавливаться
  - читаться тем же scope
- сразу отправляй “⏳ Принято / Обрабатываю”

Тишина после ввода = КРИТИЧЕСКИЙ БАГ.

════════════════════════════════════
🚀 DEPLOY GUARD (ЧТОБЫ НЕ ЛОМАЛОСЬ)
════════════════════════════════════

ЛЮБОЕ изменение проходит ТОЛЬКО так:

GitHub → CI → Tests → Behavioral E2E → Deploy → Healthcheck

ЕСЛИ:
- CI FAIL
- E2E FAIL
- Health FAIL

→ ДЕПЛОЙ ЗАПРЕЩЁН.

════════════════════════════════════
🧱 RENDER STABILITY (409 = НЕЛЬЗЯ)
════════════════════════════════════

- Только ОДИН режим: polling ИЛИ webhook
- Singleton lock ОБЯЗАТЕЛЕН
- Второй инстанс → exit(0)

409 Conflict НЕ ИМЕЕТ ПРАВА ломать продукт.

════════════════════════════════════
🧪 VERIFY = ФАКТЫ
════════════════════════════════════

verify_project.py ОБЯЗАН запускать:
- compile
- invariants (no silence)
- callbacks coverage
- models (kie only + visible)
- payments/balance
- pytest
- behavioral_e2e.py ← ГЛАВНЫЙ ТЕСТ

Если behavioral_e2e FAIL → verify FAIL → deploy FAIL.

════════════════════════════════════
📦 ФИНАЛ КАЖДОГО ПРОГОНА
════════════════════════════════════

Ты ОБЯЗАН вывести:
- behavioral summary
- transcript
- verify PASS лог
- статус деплоя Render
- список изменений

Без этого писать “готово” ЗАПРЕЩЕНО.

════════════════════════════════════
СТАРТ
════════════════════════════════════

Прекрати любые “улучшения”.
Сначала добейся:

✅ НЕТ ТИШИНЫ  
✅ ВСЕ КНОПКИ ОТВЕЧАЮТ  
✅ ВСЕ МОДЕЛИ KIE В МЕНЮ  
✅ ДЕПЛОЙ НЕ ПАДАЕТ  

Работай до ДОКАЗАННОГО GREEN.
