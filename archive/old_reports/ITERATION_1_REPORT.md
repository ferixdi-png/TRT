# ULTRA FINAL IMPLEMENTATION - Iteration 1 Report

## –î–∞—Ç–∞: 2024-12-24
## –°—Ç–∞—Ç—É—Å: ‚úÖ –ü–ï–†–í–´–ô –¶–ò–ö–õ –ó–ê–í–ï–†–®–Å–ù

---

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –≤ —ç—Ç–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

### 1. Source of Truth Architecture (–ó–ê–í–ï–†–®–ï–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞**: –°—Ç–∞—Ä—ã–π `kie_models_source_of_truth.json` —Å–æ–¥–µ—Ä–∂–∞–ª 107 –∫—Ä–∏–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π (–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è) –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω –∏ —Å—Ö–µ–º.

**–†–µ—à–µ–Ω–∏–µ**:
- ‚úÖ –°–æ–∑–¥–∞–Ω `scripts/kie_sync_registry.py` - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Å–∏–Ω–∫–µ—Ä —Å Kie API
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö endpoint'–æ–≤ –¥–ª—è discovery –º–æ–¥–µ–ª–µ–π
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ API
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç —Ü–µ–Ω: `price_rub = price_usd * fx_rate * markup`
- ‚úÖ Backup —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (model_id, pricing, schema, category)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ß–∏—Å—Ç—ã–π source of truth —Å 5 —Ä–∞–±–æ—á–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ (–º–∏–Ω–∏–º—É–º –¥–ª—è —Å—Ç–∞—Ä—Ç–∞)

```json
{
  "version": "2.0",
  "source": "manual_known_models",
  "timestamp": "2025-12-24T00:00:00Z",
  "models": [...]
}
```

### 2. Pricing System (–ó–ê–í–ï–†–®–ï–ù–û)

**–°–æ–∑–¥–∞–Ω–æ**:
- ‚úÖ `app/pricing/fx.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ–º –≤–∞–ª—é—Ç
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–∞ USD‚ÜíRUB –∏–∑ –¶–ë –†–§ API
  - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 12 —á–∞—Å–æ–≤
  - Fallback –Ω–∞ ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `FX_RUB_PER_USD`
  - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π default: 78.0

- ‚úÖ `app/pricing/free_models.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä TOP-5 cheapest
  - –§—É–Ω–∫—Ü–∏—è `is_free_model(model_id)` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–æ–∫
  - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
  - –†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–ø—É—Å–∫–∞

**–§–æ—Ä–º—É–ª–∞ —Ü–µ–Ω—ã**:
```python
price_rub = price_usd * fx_rate * 2.0  # 2x markup
```

**FREE –º–æ–¥–µ–ª—è–º–∏** —è–≤–ª—è—é—Ç—Å—è 5 —Å–∞–º—ã—Ö –¥–µ—à—ë–≤—ã—Ö –ø–æ RUB:
1. flux/schnell (0.47 RUB)
2. ideogram/v2-turbo (1.25 RUB)
3. openai/tts-1 (2.34 RUB)
4. flux/dev (3.90 RUB)
5. kling/v1.5-standard (7.80 RUB)

### 3. Safety & Testing (–ó–ê–í–ï–†–®–ï–ù–û)

**–°–æ–∑–¥–∞–Ω–æ**:
- ‚úÖ `scripts/smoke_generate_cheapest.py` - smoke —Ç–µ—Å—Ç—ã —Å –±—é–¥–∂–µ—Ç–æ–º
  - `SAFE_TEST_MODE=1` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - `MAX_TEST_CREDITS_PER_RUN=2.0` - –ª–∏–º–∏—Ç –Ω–∞ –º–æ–¥–µ–ª—å
  - `MAX_TOTAL_TEST_BUDGET=50.0` - –æ–±—â–∏–π –ª–∏–º–∏—Ç
  - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Ä–æ–≥–∏—Ö –º–æ–¥–µ–ª–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ `artifacts/smoke_test_results.json`

- ‚úÖ `scripts/kie_truth_audit.py` - –∞—É–¥–∏—Ç source of truth
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
  - –í–∞–ª–∏–¥–∞—Ü–∏—è pricing —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ TOP-5 cheapest –º–æ–¥–µ–ª–µ–π
  - –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫**:
```
‚úÖ python -m compileall . - OK
‚úÖ pytest -q - 64 passed, 6 skipped
‚úÖ python scripts/verify_project.py - OK
‚úÖ python scripts/kie_truth_audit.py - OK (5 –º–æ–¥–µ–ª–µ–π, production-ready)
```

### 4. UI/UX Refactoring (–ó–ê–í–ï–†–®–ï–ù–û)

**–û–±–Ω–æ–≤–ª–µ–Ω–æ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é**:
```python
# –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
- üé¨ –í–∏–¥–µ–æ (Reels/TikTok/Ads) ‚Üí cat:text-to-video
- üñºÔ∏è –ö–∞—Ä—Ç–∏–Ω–∫–∞ (–±–∞–Ω–Ω–µ—Ä/–ø–æ—Å—Ç) ‚Üí cat:text-to-image
- ‚ú® –£–ª—É—á—à–∏—Ç—å (–∞–ø—Å–∫–µ–π–ª) ‚Üí cat:upscale
- üéôÔ∏è –ê—É–¥–∏–æ (–æ–∑–≤—É—á–∫–∞) ‚Üí cat:text-to-speech
- üîé –í—Å–µ –º–æ–¥–µ–ª–∏ ‚Üí menu:categories
- ‚≠ê –î–µ—à—ë–≤—ã–µ/–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ ‚Üí menu:free
- üßæ –ò—Å—Ç–æ—Ä–∏—è ‚Üí menu:history
- üí≥ –ë–∞–ª–∞–Ω—Å ‚Üí menu:balance
```

**–ù–æ–≤—ã–µ handlers**:
- ‚úÖ `menu:categories` - –ø–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- ‚úÖ `menu:free` - TOP-5 cheapest —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã `CATEGORY_LABELS` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤—ã—Ö –∏ —Å—Ç–∞—Ä—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω `_is_valid_model()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `pricing` dict

### 5. –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–æ–¥–µ–ª–µ–π (–°–¢–ê–ù–î–ê–†–¢–ò–ó–ò–†–û–í–ê–ù–û)

**–ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç** (verbose, –ø–æ–Ω—è—Ç–Ω—ã–π):
- `text-to-image`, `image-to-image`
- `text-to-video`, `image-to-video`, `video-to-video`
- `text-to-speech`, `speech-to-text`
- `audio-generation`, `music-generation`, `sound-effects`
- `upscale`, `ocr`
- `lip-sync`, `background-removal`, `watermark-removal`

**Backward compatibility** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (t2i, i2v, –∏ —Ç.–ø.)

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã:
1. `scripts/kie_sync_registry.py` (590 —Å—Ç—Ä–æ–∫)
2. `app/pricing/fx.py` (135 —Å—Ç—Ä–æ–∫)
3. `app/pricing/free_models.py` (170 —Å—Ç—Ä–æ–∫)
4. `scripts/smoke_generate_cheapest.py` (320 —Å—Ç—Ä–æ–∫)
5. `models/kie_models_source_of_truth_minimal.json` (—Ä–∞–±–æ—á–∏–π –º–∏–Ω–∏–º—É–º)

### –§–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã:
1. `scripts/kie_truth_audit.py` - –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞
2. `bot/handlers/flow.py` - –Ω–æ–≤–æ–µ –º–µ–Ω—é, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, handlers
3. `tests/test_flow_smoke.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø–æ–¥ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
4. `tests/test_flow_ui.py` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–µ–Ω—é

### –ö–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:
```bash
‚úÖ python -m compileall .
‚úÖ python -m pytest tests/ -q
‚úÖ python scripts/verify_project.py
‚úÖ python scripts/kie_truth_audit.py
```

---

## üî• TOP-5 –ø—Ä–æ–±–ª–µ–º –î–û —Ñ–∏–∫—Å–∞

1. ‚ùå **–ö—Ä–∏–≤–æ–π source of truth**: 107 –º–æ–¥–µ–ª–µ–π-–º—É—Å–æ—Ä–∞ (–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã/–∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã) –±–µ–∑ —Ü–µ–Ω
2. ‚ùå **–ù–µ—Ç pricing —Å–∏—Å—Ç–µ–º—ã**: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ FX –∫—É—Ä—Å–∞, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã
3. ‚ùå **–ù–µ—Ç free models –ª–æ–≥–∏–∫–∏**: –Ω–µ –±—ã–ª–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ TOP-5 cheapest
4. ‚ùå **–°—Ç–∞—Ä—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**: t2v/t2i –≤–º–µ—Å—Ç–æ text-to-video/text-to-image
5. ‚ùå **–ù–µ—Ç safety —Ä–µ–∂–∏–º–∞**: —Ä–∏—Å–∫ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å 1000 credits –Ω–∞ —Ç–µ—Å—Ç–∞—Ö

## ‚úÖ TOP-5 –ø—Ä–æ–±–ª–µ–º –ü–û–°–õ–ï —Ñ–∏–∫—Å–∞

–í—Å–µ 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º **–†–ï–®–ï–ù–´**:
1. ‚úÖ Source of truth —á–∏—Å—Ç—ã–π, 5 –≤–∞–ª–∏–¥–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
2. ‚úÖ Pricing —Å–∏—Å—Ç–µ–º–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º FX –∫—É—Ä—Å–æ–º
3. ‚úÖ Free models = –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π TOP-5 cheapest
4. ‚úÖ –ù–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + backward compatibility
5. ‚úÖ SAFE_TEST_MODE –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞

---

## üí∞ –ë—é–¥–∂–µ—Ç (credits tracking)

**–ü–æ—Ç—Ä–∞—á–µ–Ω–æ –≤ —ç—Ç–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏**: 0 credits
- –¢–µ—Å—Ç—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å (–Ω–µ—Ç KIE_API_KEY –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏)
- –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ stub –∫–ª–∏–µ–Ω—Ç–µ

**–õ–∏–º–∏—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã**:
- MAX_TEST_CREDITS_PER_RUN = 2.0
- MAX_TOTAL_TEST_BUDGET = 50.0
- SAFE_TEST_MODE = 1 (enabled)

---

## üéØ –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. **–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π KIE_API_KEY** –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å `kie_sync_registry.py`
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π (50-100 –º–æ–¥–µ–ª–µ–π)
   - –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã
   - –ó–∞–ø–æ–ª–Ω–∏—Ç—å input_schema –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏

2. **Smoke —Ç–µ—Å—Ç—ã –Ω–∞ –¥–µ—à—ë–≤—ã—Ö –º–æ–¥–µ–ª—è—Ö**
   - –ü—Ä–æ–≥–Ω–∞—Ç—å 10 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –Ω–∞ TOP-10 cheapest
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É createTask/recordInfo
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±–∞–ª–∞–Ω—Å —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

3. **–ë–∞–ª–∞–Ω—Å/–ò—Å—Ç–æ—Ä–∏—è/–†–µ—Ñ–∞–Ω–¥—ã**
   - –î–æ–±–∞–≤–∏—Ç—å –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refund –ø—Ä–∏ failure
   - –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π —Å snapshot input

4. **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≤ Telegram**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
   - –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ
   - –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
   - –†–µ—Å–∏–Ω–∫ –º–æ–¥–µ–ª–µ–π (–∑–∞–ø—É—Å–∫ kie_sync_registry.py)

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
5. **–î–æ—Ä–∞–±–æ—Ç–∫–∞ UX**
   - –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
   - –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   - –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞"

6. **Render deployment**
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π shutdown (—Å–Ω—è—Ç–∏–µ lock)
   - Healthcheck
   - Zero-downtime restarts

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
7. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
8. –ú–µ—Ç—Ä–∏–∫–∏/–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
9. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

---

## üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Å—Å–∏–∏

### –ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É:

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å KIE_API_KEY –≤ Codespaces Secrets**
   ```bash
   # –í settings —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è ‚Üí Codespaces ‚Üí Secrets
   # –î–æ–±–∞–≤–∏—Ç—å: KIE_API_KEY = <–≤–∞—à –∫–ª—é—á>
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω–∫ –º–æ–¥–µ–ª–µ–π**
   ```bash
   python scripts/kie_sync_registry.py
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç**
   ```bash
   python scripts/kie_truth_audit.py
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç—å smoke —Ç–µ—Å—Ç—ã** (—Å –ª–∏–º–∏—Ç–∞–º–∏!)
   ```bash
   export SAFE_TEST_MODE=1
   export MAX_TOTAL_TEST_BUDGET=50.0
   python scripts/smoke_generate_cheapest.py --runs 10
   ```

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã**
   ```bash
   python -m compileall .
   pytest -q
   python scripts/verify_project.py
   ```

---

## üéâ –í—ã–≤–æ–¥—ã

–ü–µ—Ä–≤–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è **–£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–ê**. –ü–æ—Å—Ç—Ä–æ–µ–Ω —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç:
- ‚úÖ Source of Truth –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ Pricing —Å–∏—Å—Ç–µ–º–∞ —Å FX
- ‚úÖ Free models (TOP-5 cheapest)
- ‚úÖ Safety —Ä–µ–∂–∏–º –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ –º–µ–Ω—é –∏ UX
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (64 passed)

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤** –∫ –ø–æ–ª—É—á–µ–Ω–∏—é —Ä–µ–∞–ª—å–Ω–æ–≥–æ KIE_API_KEY –∏ –ø–µ—Ä–µ—Ö–æ–¥—É –∫ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏.

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –º–æ–¥–µ–ª–µ–π.
