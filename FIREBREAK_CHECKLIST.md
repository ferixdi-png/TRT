# üî• FIREBREAK MODE - –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ OID out of range
- –í—Å–µ `pg_try_advisory_lock(%s)` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `pg_try_advisory_lock(%s, %s)` —Å (k1, k2)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `split_bigint_to_pg_advisory_oids()` –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è 64-bit ‚Üí –¥–≤–∞ 32-bit OID
- –ó–∞–ø—Ä–æ—Å—ã –∫ `pg_locks` —Ç–µ–ø–µ—Ä—å —Ñ–∏–ª—å—Ç—Ä—É—é—Ç –ø–æ `classid=%s AND objid=%s` (–æ–±–∞ int4)
- **–ù–µ—Ç** bigint‚ÜíOID –∫–∞—Å—Ç–æ–≤ –Ω–∏–≥–¥–µ

### 2. ‚úÖ –¢—Ä–æ—Ç—Ç–ª–∏–Ω–≥ –∏ backoff
- –õ–æ–≥–∏ lock held: –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 30s
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff: 0.5s ‚Üí 1s ‚Üí 2s ‚Üí 5s
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∞–º –≤ Render –ª–æ–≥–∞—Ö

### 3. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
–ö–æ–º–∞–Ω–¥—ã:
```bash
make firebreak       # –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (unit tests + smoke + syntax)
make smoke-render    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Render /health
make deploy-check    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Render –ª–æ–≥–æ–≤ –∑–∞ 10 –º–∏–Ω—É—Ç
```

### 4. ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ FIREBREAK
**–ö—Ä–∏—Ç–µ—Ä–∏–π –ø—Ä–∏—ë–º–∫–∏:**
- 0 —Å—Ç—Ä–æ–∫ `ERROR` –≤ –ª–æ–≥–∞—Ö –∑–∞ 10 –º–∏–Ω—É—Ç
- 0 —Å—Ç—Ä–æ–∫ `Traceback` –≤ –ª–æ–≥–∞—Ö
- 0 —Å—Ç—Ä–æ–∫ `OID out of range` –≤ –ª–æ–≥–∞—Ö
- /health –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK
- S1+S2 smoke tests –∑–µ–ª—ë–Ω—ã–µ

## –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è)

### –®–∞–≥ 1: Smoke test –Ω–∞ Render
```bash
make smoke-render
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ S0 /health: PASSED
‚úÖ S1 Bot responsive: PASSED
‚úÖ S2 Storage: PASSED
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```bash
make deploy-check
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –õ–æ–≥–∏ —á–∏—Å—Ç—ã–µ - –æ—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!
‚úÖ FIREBREAK PASSED
```

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–∞ stable-firebreak-1
–ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–µ–ª—ë–Ω—ã–µ:
```bash
git tag -a stable-firebreak-1 -m "FIREBREAK: –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ OID errors, —Ç—Ä–æ—Ç—Ç–ª–∏–Ω–≥, backoff"
git push origin stable-firebreak-1
```

## –ß—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å –¥–æ –∑–µ–ª—ë–Ω–æ–≥–æ FIREBREAK

‚ùå –ù–æ–≤—ã–µ —Ñ–∏—á–∏
‚ùå –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
‚ùå –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
‚ùå "–£–ª—É—á—à–µ–Ω–∏—è" –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ—à–∏–±–∫–∏

‚úÖ –¢–æ–ª—å–∫–æ —Ñ–∏–∫—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —É—Å—Ç—Ä–∞–Ω—è—é—Ç ERROR/Traceback –≤ –ª–æ–≥–∞—Ö

## –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –ø–æ—Å–ª–µ FIREBREAK

1. **–õ—é–±–æ–π –º–µ—Ä–¥–∂** —Ç—Ä–µ–±—É–µ—Ç:
   - `make firebreak` –∑–µ–ª—ë–Ω—ã–π
   - Smoke test –Ω–∞ Render –∑–µ–ª—ë–Ω—ã–π
   - –õ–æ–≥–∏ –∑–∞ 10 –º–∏–Ω—É—Ç —á–∏—Å—Ç—ã–µ

2. **Deploy checklist:**
   - [ ] `make firebreak` ‚Üí PASSED
   - [ ] –î–µ–ø–ª–æ–π –Ω–∞ Render
   - [ ] –ñ–¥–µ–º 2 –º–∏–Ω—É—Ç—ã
   - [ ] `make deploy-check` ‚Üí PASSED
   - [ ] –ï—Å–ª–∏ –∫—Ä–∞—Å–Ω—ã–π ‚Üí rollback + —Ñ–∏–∫—Å
   - [ ] –ï—Å–ª–∏ –∑–µ–ª—ë–Ω—ã–π ‚Üí —Å–æ–∑–¥–∞—Ç—å —Ç–µ–≥

3. **–ü—Ä–∞–≤–∏–ª–∞ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - `stable-firebreak-N` - —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–µ–ª—ë–Ω–æ–≥–æ deploy-check
   - –ö–∞–∂–¥—ã–π —Ç–µ–≥ = –≥–∞—Ä–∞–Ω—Ç–∏—è 0 –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
   - Rollback –≤—Å–µ–≥–¥–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π stable-firebreak —Ç–µ–≥

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

**–î–µ–ø–ª–æ–π:** –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ (~2 –º–∏–Ω—É—Ç—ã)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ß–µ—Ä–µ–∑ 2-3 –º–∏–Ω—É—Ç—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å:
make smoke-render
make deploy-check
```

**–ï—Å–ª–∏ –∑–µ–ª—ë–Ω—ã–π:**
```bash
git tag -a stable-firebreak-1 -m "FIREBREAK: 0 errors in logs"
git push origin stable-firebreak-1
```

**–ï—Å–ª–∏ –∫—Ä–∞—Å–Ω—ã–π:**
- –ß–∏—Ç–∞–µ–º –ª–æ–≥–∏
- –õ–æ–∫–∞–ª–∏–∑—É–µ–º –ø—Ä–∏—á–∏–Ω—É
- –°–æ–∑–¥–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ñ–∏–∫—Å
- –ü–æ–≤—Ç–æ—Ä—è–µ–º

---

**FIREBREAK = Zero tolerance –¥–ª—è ERROR –≤ –ª–æ–≥–∞—Ö**
