# üöÄ KIE Telegram Bot - –í–µ—Ä—Å–∏—è –¥–ª—è Render.com

## üìÅ –≠—Ç–∞ –ø–∞–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ Render.com

### ‚úÖ –ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:

- ‚úÖ –í—Å–µ Python —Ñ–∞–π–ª—ã –±–æ—Ç–∞
- ‚úÖ Dockerfile –¥–ª—è Render
- ‚úÖ Node.js wrapper (index.js)
- ‚úÖ –í—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

### üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:

1. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã –≤ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**

2. **–û—Ç–∫—Ä–æ–π—Ç–µ Render.com:**
   - https://dashboard.render.com/
   - –°–æ–∑–¥–∞–π—Ç–µ Web Service
   - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
   - Environment: **Docker**
   - Branch: **main**

4. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```
   TELEGRAM_BOT_TOKEN=–≤–∞—à_–Ω–æ–≤—ã–π_—Ç–æ–∫–µ–Ω (–ü–û–°–õ–ï /revoke –≤ BotFather!)
   KIE_API_KEY=–≤–∞—à_–∫–ª—é—á
   ADMIN_ID=–≤–∞—à_id
   
   # CRITICAL: –î–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (multi-instance safe locks) ‚ö†Ô∏è
   # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ 2+ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤:
   DATABASE_URL=postgresql://user:pass@host:5432/dbname
   REDIS_URL=redis://host:6379/0
   
   # –ë–µ–∑ DATABASE_URL/REDIS_URL:
   #   lock_mode=file, lock_degraded=true (–ù–ï –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è 2+ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤!)
   # –° DATABASE_URL:
   #   lock_mode=postgres, lock_degraded=false ‚úÖ (safe –¥–ª—è 2+ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤)
   # –° REDIS_URL:
   #   –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: —Å–µ—Å—Å–∏–∏, –∫—ç—à, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è callback'–æ–≤
   ```
   **–í–ê–ñ–ù–û:** –¢–æ–∫–µ–Ω —É–∂–µ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /revoke –≤ BotFather –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—ã–π!

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ!**

### üìÑ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:

- **RENDER_QUICK_START.md** - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (5 –º–∏–Ω—É—Ç)
- **RENDER_DEPLOY.md** - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:

```
render/
‚îú‚îÄ‚îÄ Dockerfile              # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ index.js                # Node.js wrapper
‚îú‚îÄ‚îÄ package.json            # Node.js –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ entrypoints/run_bot.py  # –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π Python entrypoint
‚îú‚îÄ‚îÄ run_bot.py              # Wrapper (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
‚îú‚îÄ‚îÄ bot_kie.py              # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ requirements.txt        # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ render.yaml             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Render (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îî‚îÄ‚îÄ ...                     # –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
```

### ‚ñ∂Ô∏è Render entrypoint + –∫–ª—é—á–µ–≤—ã–µ ENV (–∫–∞–Ω–æ–Ω–∏—á–Ω–æ)

- **Entrypoint (SSOT):** `python entrypoints/run_bot.py`
- **Webhook-—Ä–µ–∂–∏–º (Web Service):**
  - `BOT_MODE=webhook`
  - `TELEGRAM_BOT_TOKEN=...`
  - `WEBHOOK_URL=https://<service>.onrender.com/webhook`
  - `PORT=10000` (healthcheck server)
  - `AUTO_SET_WEBHOOK=1` (–∞–≤—Ç–æ-—É—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ)
  - `REQUIRE_WEBHOOK_REGISTERED=1` (fail-fast –µ—Å–ª–∏ webhook –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω)
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ:**
  - `STORAGE_MODE=db` + `DATABASE_URL=...` (Postgres)
  - `REDIS_URL=...` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –±—ã—Å—Ç—Ä—ã–µ distributed locks)
- **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:** `KIE_API_KEY=...`, `BOT_INSTANCE_ID=partner-01`, `ENABLE_HEALTH_SERVER=1`

### üîÅ –ü–æ–≤–µ–¥–µ–Ω–∏–µ webhook –ø—Ä–∏ —Å–±–æ–µ Telegram API

- –ï—Å–ª–∏ `setWebhook` –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç/—Ç–∞–π–º–∞—É—Ç–∏—Ç, —Å–µ—Ä–≤–∏—Å **–Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å**.
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook —É—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–æ–≤—ã–π retry-–∫–æ–Ω—Ç—É—Ä —Å backoff (–∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã, 2‚Äì3 –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞ —Ü–∏–∫–ª).
- –ö–æ–≥–¥–∞ Telegram —Å–Ω–æ–≤–∞ –¥–æ—Å—Ç—É–ø–µ–Ω, webhook –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### ‚ö†Ô∏è –í–∞–∂–Ω–æ:

- –§–∞–π–ª `.env` –ù–ï –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –ø–∞–Ω–µ–ª–∏ Render
- –ù–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º –ø–ª–∞–Ω–µ —Å–µ—Ä–≤–∏—Å "–∑–∞—Å—ã–ø–∞–µ—Ç" –ø–æ—Å–ª–µ 15 –º–∏–Ω—É—Ç

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é! üéâ**
