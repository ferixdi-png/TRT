# –ë–´–°–¢–†–´–ô –ß–ï–ö-–õ–ò–°–¢ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò

## üöÄ –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ Render

### 1. Health Check (30 —Å–µ–∫—É–Ω–¥)
```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_APP –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π URL Render
export APP_URL="https://your-app.onrender.com"

# –û–±—â–µ–µ –∑–¥–æ—Ä–æ–≤—å–µ
curl $APP_URL/health | jq

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# {
#   "status": "ok",
#   "active": true,
#   "queue": {
#     "queue_depth": 0-3,
#     "drop_rate": < 1
#   }
# }
```

### 2. Webhook Status (30 —Å–µ–∫—É–Ω–¥)
```bash
curl $APP_URL/diag/webhook | jq

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# {
#   "pending_update_count": 0,          ‚Üê –ö–†–ò–¢–ò–ß–ù–û!
#   "last_error_message": "",           ‚Üê –ö–†–ò–¢–ò–ß–ù–û!
#   "url": "https://.../webhook/***"
# }
```

### 3. Telegram /start (10 —Å–µ–∫—É–Ω–¥)
- –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ –≤ Telegram
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/start`
- ‚úÖ –î–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å **–º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ** (<1s)
- ‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é

### 4. –õ–æ–≥–∏ Render (1 –º–∏–Ω—É—Ç–∞)
–ò—Å–∫–∞—Ç—å —Å—Ç—Ä–æ–∫–∏:
```
[QUEUE] Workers started (background update processing)
[WEBHOOK_EARLY] ‚úÖ ‚úÖ ‚úÖ WEBHOOK CONFIGURED
[WORKER_0] Started
[WORKER_1] Started
[WORKER_2] Started
```

## üî¥ –ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —ç—Ç–æ ‚Üí –ø—Ä–æ–±–ª–µ–º–∞:
- ‚ùå `pending_update_count > 10` –≤ /diag/webhook
- ‚ùå `last_error_message != ""` –≤ /diag/webhook
- ‚ùå /start –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç >3 —Å–µ–∫—É–Ω–¥
- ‚ùå –í –ª–æ–≥–∞—Ö: `[WEBHOOK] Read timeout expired`

## üß™ SINGLE_MODEL Test (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –≤–∫–ª—é—á–∏–ª–∏ `SINGLE_MODEL_ONLY=1`:

1. /start ‚Üí –∫–Ω–æ–ø–∫–∞ "üñº –°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É"
2. –ù–∞–∂–∞—Ç—å ‚Üí "–û–ø–∏—à–∏—Ç–µ –∫–∞—Ä—Ç–∏–Ω–∫—É"
3. –í–≤–µ—Å—Ç–∏: "–∫–æ—Ç –≤ –∫–æ—Å–º–æ—Å–µ"
4. –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç: "1:1"
5. –ü–æ–¥–æ–∂–¥–∞—Ç—å 10-30 —Å–µ–∫
6. ‚úÖ –ü–æ–ª—É—á–∏—Ç—å —Ñ–æ—Ç–æ

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–∫–∞–∂–¥—ã–π —á–∞—Å –ø–µ—Ä–≤—ã–µ —Å—É—Ç–∫–∏)

```bash
# Webhook health
curl $APP_URL/diag/webhook | jq .pending_update_count

# Queue health
curl $APP_URL/health | jq .queue.drop_rate

# –û–±–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–ª–∏–∑–∫–∏ –∫ 0
```

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å

1. **–û—Ç–∫–∞—Ç –∫–æ–º–º–∏—Ç–∞**:
```bash
git revert HEAD
git push origin main
```

2. **–ò–ª–∏ –æ—Ç–∫–∞—Ç —á–µ—Ä–µ–∑ Render UI**:
   - Settings ‚Üí Deploys
   - –ù–∞–π—Ç–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —É—Å–ø–µ—à–Ω—ã–π deploy
   - –ù–∞–∂–∞—Ç—å "Deploy"

3. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Render: Build Logs + Deploy Logs
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ENV variables (–≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç?)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `/health` (503 = –Ω–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª)

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

- [x] /start –æ—Ç–≤–µ—á–∞–µ—Ç <1s
- [x] pending_update_count = 0
- [x] last_error_message –ø—É—Å—Ç–æ–π
- [x] –í –ª–æ–≥–∞—Ö: WEBHOOK CONFIGURED
- [x] –í –ª–æ–≥–∞—Ö: Workers started
- [x] (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Z-image —Ä–∞–±–æ—Ç–∞–µ—Ç end-to-end

---

**–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ = 2 –º–∏–Ω—É—Ç—ã**  
**–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ = 5 –º–∏–Ω—É—Ç**  
**SINGLE_MODEL —Ç–µ—Å—Ç = 1 –º–∏–Ω—É—Ç–∞**

–ï—Å–ª–∏ –≤—Å–µ ‚úÖ ‚Üí –¥–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω! üéâ
